# Agency Scheduler Configuration
# Runs scheduled maintenance tasks across repositories
#
# Port configuration (dev defaults below, deploy-agency.sh adjusts for prod):
#   Dev:  director=8080, agent=9000
#   Prod: director=9080, agent=9100

port: 9010

# Director URL for session tracking (sessions will be viewable in web UI)
# Scheduler tries director first, falls back to agent if unavailable.
# Use the web director's internal HTTP port for unauthenticated localhost API.
# Start the web director with: ag-view-web -internal-port=8080
director_url: http://localhost:8080

# Direct agent URL (fallback when director is unavailable)
agent_url: https://localhost:9000

jobs:
  - name: smoke-test
    schedule: "0 0 31 2 *"  # Never auto-runs (Feb 31)
    agent_kind: claude
    model: haiku
    timeout: 60s
    prompt: |
      This is a smoke test. Reply with exactly: "Smoke test OK"

  - name: smoke-test-codex
    schedule: "0 0 31 2 *"  # Never auto-runs (Feb 31)
    agent_kind: codex
    agent_url: https://localhost:9001
    timeout: 60s
    prompt: |
      This is a smoke test for codex. Reply with exactly: "Codex smoke test OK"

  - name: nightly-maintenance
    schedule: "0 1 * * *"
    agent_kind: claude
    model: opus
    timeout: 2h
    prompt: |
      # Nightly Maintenance Run

      Perform maintenance tasks across the specified repositories.
      Do lots of work, not just one change.
      Work through each repository sequentially.

      ## Target Repositories
      - agency
      - opengrok-navigator
      - lldb-objc
      - cue
      - h2ai

      ## Tasks for Each Repository

      ### 1. Code Cleanup
      - Remove dead code and unused imports
      - Fix obvious code style issues
      - Refactor out any duplication
      - Fix inconsistencies or logic errors

      ### 2. Testing
      - Run the test suite and fix any failing tests
      - Add tests for uncovered edge cases
      - Ensure CI would pass

      ### 3. Bug Fixing
      - Check for and fix any TODO/FIXME items that are straightforward
      - Address any obvious bugs discovered during testing

      ### 4. Documentation Updates
      - Update README if code changes affect usage
      - Ensure doc comments match current behavior
      - Update CHANGELOG with any notable fixes

      ### 5. Report Project Health
      - Summarise the state of the project as you found it
      - Include what you then discovered/did
      - Finish with anything you couldn't do/questions/next steps

      ## Workflow

      For each repository:
      1. Clone from alan-phobos-org/<repo>
      2. Run tests to establish baseline
      3. Perform maintenance tasks
      4. Run tests again to verify no regressions
      5. Commit changes with descriptive messages
      6. Move to next repository

  - name: daily-newsletter
    schedule: "0 6 * * *"  # 06:00 UTC daily
    agent_kind: claude
    model: opus
    timeout: 30m
    prompt: |
      Build today's newsletter, commit it, push, and merge the resulting PR to main.

      ## Setup
      1. Clone the knowledge repository fresh:
         ```
         git clone https://github.com/alan-phobos-org/knowledge.git
         cd knowledge
         ```
      2. Ensure you are on the latest head of main:
         ```
         git checkout main && git reset --hard origin/main && git clean -fd
         ```

      ## Tasks
      1. Build today's newsletter ({{.Date}})
      2. Create a new branch for the newsletter
      3. Commit the newsletter changes
      4. Push the branch
      5. Create a pull request
      6. Merge the PR to main

      When complete, provide a brief summary in <summary> tags:
      <summary>
      Newsletter status for {{.Date}}
      </summary>
  